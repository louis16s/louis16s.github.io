{"id":744,"date":"2023-06-02T18:50:41","date_gmt":"2023-06-02T10:50:41","guid":{"rendered":"http:\/\/192.168.5.111\/?p=744"},"modified":"2023-07-04T17:19:38","modified_gmt":"2023-07-04T09:19:38","slug":"srun_auto_login","status":"publish","type":"post","link":"http:\/\/192.168.5.111\/index.php\/2023\/06\/02\/srun_auto_login\/","title":{"rendered":"\u6821\u56ed\u7f51\u81ea\u52a8\u767b\u5f55"},"content":{"rendered":"\n<p>\u65ad\u7ebf\u91cd\u8fde<\/p>\n\n\n\n<figure class=\"wp-block-image size-full\"><img decoding=\"async\" loading=\"lazy\" width=\"503\" height=\"533\" src=\"http:\/\/192.168.5.111\/wp-content\/uploads\/2023\/06\/\u5c4f\u5e55\u622a\u56fe-2023-03-15-160451.jpg\" alt=\"\" class=\"wp-image-746\" srcset=\"http:\/\/192.168.5.111\/wp-content\/uploads\/2023\/06\/\u5c4f\u5e55\u622a\u56fe-2023-03-15-160451.jpg 503w, http:\/\/192.168.5.111\/wp-content\/uploads\/2023\/06\/\u5c4f\u5e55\u622a\u56fe-2023-03-15-160451-283x300.jpg 283w\" sizes=\"(max-width: 503px) 100vw, 503px\" \/><\/figure>\n\n\n\n<pre class=\"wp-block-code\"><code>#!\/user\/bin\/env pyhton\u89e3\u91ca\u5668\u8def\u5f84\n# -*-coding:utf-8-*- \u811a\u672c\u7f16\u7801\nimport cryptocode\nimport msvcrt\nimport os\nimport requests\nimport time\nimport pywifi\nfrom pywifi import const\nfrom configparser import ConfigParser\nfrom datetime import datetime\nfrom playwright.sync_api import Playwright, sync_playwright\nfrom rich.align import Align\nfrom rich.console import Console\nfrom rich.panel import Panel\nfrom rich.progress import track\nfrom rich.live import Live\nfrom rich.text import Text\n\nfile100 = 'config.ini'\nversion_info = '1.5'\n\n# \u8303\u56f4\u65f6\u95f4\nd_time = datetime.strptime(str(datetime.now().date())+'6:30', '%Y-%m-%d%H:%M')\nd_time1 =  datetime.strptime(str(datetime.now().date())+'23:30', '%Y-%m-%d%H:%M')\n\ndef run(playwright: Playwright) -&gt; None:\n    try:\n        global context\n        browser = playwright.chromium.launch(headless=mode, channel=local)\n        context = browser.new_context()\n        page = context.new_page()\n        printer('url: ' + testurl)\n        page.goto(testurl)\n        printer('account: ' + account)\n        page.locator(\"&#91;placeholder=\\\"\u8bf7\u8f93\u5165\u8d26\u53f7\\\"]\").fill(account)  # .type(account)\n        printer('password: ' + len(password) * '*')\n        page.locator(\"&#91;placeholder=\\\"\u8bf7\u8f93\u5165\u5bc6\u7801\\\"]\").fill(password)\n        page.locator(\"xpath=\/\/*&#91;@id='protocol']\").click()\n        printer('submit')\n        page.locator(\"text=\u767b\u5f55\").click()\n        browser.close()\n        if network_check():\n            printer('success')\n        else:\n            printer('fail')\n\n    except:\n        printer('fail')\n\n    # \u4e0b\u7ebf\u529f\u80fd\n    ''' printer('enter to log out')\n        if len(input()) != 0:\n            page.click('xpath=\/\/*&#91;@id=\"logout\"]')\n            page.click('text=\u786e\u8ba4')\n            printer('exiting program...')\n            time.sleep(5)\n            #browser.close()\n            #sys.exit()'''\n\ndef file1():  # \u6587\u4ef6\u8bfb\u5199\n    global account, password, testurl, mode, local, connect, check\n    console = Console()\n    if os.path.exists(file100):  # \u6587\u4ef6\u5b58\u5728\u68c0\u6d4b\n        # printer('file existed')\n        cf = ConfigParser()\n        cf.read(file100)\n        version = cf.get('parm', 'ver')\n        if version &lt; version_info:\n            os.remove(file100)\n            with console.screen(style=\"bold white on red\") as screen:\n                text = Align.center(\"&#91;blink]\u914d\u7f6e\u6587\u4ef6\\n\u7248\u672c\u8fc7\u4f4e\\n\u81ea\u52a8\u5220\u9664&#91;\/blink]\", vertical=\"middle\")\n                screen.update(Panel(text))\n                time.sleep(5)\n            file1()\n        # main\n        account = cf.get('main', 'uid')\n        password = cf.get('main', 'pwd')\n        # parm\n        local = cf.get('parm', 'local')\n        mode = cf.get('parm', 'mode')\n        check = cf.get('parm', 'check')\n        connect = cf.get('parm', 'connect')\n        testurl = cf.get('parm', 'url')\n\n        # return account, password, testurl, mode, local, connect, check\n    else:\n        printer('config file not fund')\n        os.system('mode con cols=48 lines=23')\n        printer('\u5bc6\u7801\u4f1a\u81ea\u52a8\u52a0\u5bc6')\n        printer('\u8f93\u5165\u540e\u8bf7\u6309\u56de\u8f66')\n        printer('input account')\n        account = input()\n\n        printer('input password')\n        password = pwd_input()\n        print(' ')\n\n        printer('\u8fd0\u884c\u6a21\u5f0f\u9009\u62e9')\n        printer('headless(1)|browser(2)')\n        mode = input()\n\n        printer('\u6d4f\u89c8\u5668\u9009\u62e9')\n        printer('edge(1)|chrome(2)')\n        local = input()\n\n        printer('\u4f7f\u7528\u7f51\u7ebf(0)|GDOU.NET(1)')\n        connect = input()\n\n        printer('\u7f51\u7edc\u68c0\u67e5\u95f4\u9694\uff08\u79d2\uff09')\n        check = int(input())\n\n        testurl = 'http:\/\/1.1.1.1\/'\n        t0 = '\\n'\n        password = cryptocode.encrypt(password, 'louis16s')  # \u52a0\u5bc6\n\n        with open(file100, \"w\") as file:\n            file.write(\n                '&#91;main]' + t0 +\n                'uid = ' + str(account) + t0 +\n                'pwd = ' + str(password) + t0 +\n                '&#91;parm]' + t0 +\n                'local = ' + str(local) + t0 +\n                'mode = ' + str(mode) + t0 +\n                'check = ' + str(check) + t0 +\n                'connect = ' + str(connect) + t0 +\n                'url = ' + str(testurl) + t0 +\n                'ver = ' + version_info + t0)\n            file.close()\n        for step in track(range(100), description=\"Writing...\"):\n            time.sleep(0.01)\n        printer('config is generated')\n\n    password = cryptocode.decrypt(password, 'louis16s')  # \u89e3\u5bc6\n    # \u6d4f\u89c8\u5668\n    if local == '0':\n        local = None  # Chromium\n    if local == '1':\n        local = 'msedge'\n    if local == '2':\n        local = 'chrome'\n\n    if mode == '1':\n        mode = True  # \u65e0\u5934\u6a21\u5f0f\n    else:\n        mode = False\n\n    return account, password, testurl, mode, local, connect, check\n\ndef connect_wifi(ssid):\n    if ssid == '1':\n        ssid0 = \"GDOU.NET\"\n    if ssid == '2':\n        ssid0 = \"\u6d77\u5927\u6821\u56ed\u7f51\"\n    wifi = pywifi.PyWiFi()\n    ifaces = wifi.interfaces()&#91;0]\n    print(ifaces.name())  # \u8f93\u51fa\u65e0\u7ebf\u7f51\u5361\u540d\u79f0\n    ifaces.disconnect()\n    time.sleep(3)\n    profile = pywifi.Profile()  # \u914d\u7f6e\u6587\u4ef6\n    profile.ssid = ssid0  # wifi\u540d\u79f0\n    ifaces.remove_all_network_profiles()  # \u5220\u9664\u5176\u5b83\u914d\u7f6e\u6587\u4ef6\n    tmp_profile = ifaces.add_network_profile(profile)  # \u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6\n    ifaces.connect(tmp_profile)\n    time.sleep(3)\n    isok = True\n\n    if ifaces.status() == const.IFACE_CONNECTED:\n        print(\"connect successfully!\")\n    else:\n        print(\"connect failed!\")\n        print('turn on ur wifi')\n        time.sleep(5)\n        connect_wifi(ssid)\n\n    time.sleep(1)\n    return isok\n\ndef network_check():\n    try:\n        session = requests.Session()\n        html = session.get(\"https:\/\/www.baidu.com\", timeout=2)\n    except:\n        return False\n    return True\n\ndef os_checker():\n    temp = file1()\n    if temp&#91;5] != \"0\":\n        connect_wifi(temp&#91;5])\n    #os_version = platform.platform()\n    if os.path.exists(file100):\n        os.system('mode con cols=45 lines=8')\n        printer('version ' + version_info)\n        printer('script started')\n\ndef pwd_input():  # \u5bc6\u7801\n    chars = &#91;]\n    while True:\n        try:\n            newChar = msvcrt.getch().decode(encoding=\"utf-8\")\n        except:\n            return input(\"\u4f60\u5f88\u53ef\u80fd\u4e0d\u662f\u5728cmd\u547d\u4ee4\u884c\u4e0b\u8fd0\u884c\uff0c\u5bc6\u7801\u8f93\u5165\u5c06\u4e0d\u80fd\u9690\u85cf:\")\n        if newChar in '\\r\\n':  # \u5982\u679c\u662f\u6362\u884c\uff0c\u5219\u8f93\u5165\u7ed3\u675f\n            break\n        elif newChar == '\\b':  # \u5982\u679c\u662f\u9000\u683c\uff0c\u5219\u5220\u9664\u5bc6\u7801\u672b\u5c3e\u4e00\u4f4d\u5e76\u4e14\u5220\u9664\u4e00\u4e2a\u661f\u53f7\n            if chars:\n                del chars&#91;-1]\n                msvcrt.putch('\\b'.encode(encoding='utf-8'))  # \u5149\u6807\u56de\u9000\u4e00\u683c\n                msvcrt.putch(' '.encode(encoding='utf-8'))  # \u8f93\u51fa\u4e00\u4e2a\u7a7a\u683c\u8986\u76d6\u539f\u6765\u7684\u661f\u53f7\n                msvcrt.putch('\\b'.encode(encoding='utf-8'))  # \u5149\u6807\u56de\u9000\u4e00\u683c\u51c6\u5907\u63a5\u53d7\u65b0\u7684\u8f93\u5165\n        else:\n            chars.append(newChar)\n            msvcrt.putch('*'.encode(encoding='utf-8'))  # \u663e\u793a\u4e3a\u661f\u53f7\n    return (''.join(chars))\n\ndef printer(content):  # \u5f69\u8272\u8f93\u51fa\n    console = Console()\n    time1 = datetime.now().strftime('&#91;%Y-%m-%d]&#91;%H:%M:%S]')\n    console.print(time1, end='')\n    console.print(content, style=\"yellow\")\n\ndef info():\n    try:\n        url = (\"http:\/\/10.129.1.1\/cgi-bin\/rad_user_info?\"\n               \"callback=jQuery112406118340540763985_1556004912581&amp;_=1556004912582\")  # \u6307\u5b9a\u7f51\u5740\n        response = requests.get(url=url)  # \u53d1\u8d77\u8bf7\u6c42#get\u4f1a\u8fd4\u56de\u4e00\u4e2a\u54cd\u5e94\u5bf9\u8c61\n        detail = response.text.split(',')\n\n        ip = str(detail&#91;12].split(':')&#91;1]).replace('\"', \" \")\n        printer(\"ip:\" + ip)\n        sum = str(int(int(detail&#91;20].split(':')&#91;1])*0.000000001))\n        printer(\"\u5df2\u7528\u6d41\u91cf\uff1a\"+sum+\"GB\")\n        device = str(detail&#91;11].split(':')&#91;1]).replace('\"',\" \")\n        printer(\"\u5728\u7ebf\u8bbe\u5907:\" + device)\n    except:\n        printer(\"\u83b7\u53d6\u4fe1\u606f\u5931\u8d25\")\n\ndef time_update():\n    time1 = str(datetime.now().strftime('&#91;%Y-%m-%d]&#91;%H:%M:%S]'))\n    text = Text(time1+\"\u811a\u672c\u6b63\u5e38\u8fd0\u884c\u4e2d(\u65e0\u63d0\u793a)\")  # create renderable text object\n    live.update(text)  # update display with text object\n\nif __name__ == '__main__':\n    temp = file1()\n    os_checker()\n    i = 1\n    n = 1\n    with Live(refresh_per_second=1) as live:  # refresh once per second\n        while True:\n            # \u5f53\u524d\u65f6\u95f4\n            n_time = datetime.now()\n            if n_time &gt; d_time and n_time &lt; d_time1:\n                if network_check():#\u7f51\u7edc\u6b63\u5e38\n                    if i == 1:\n                        printer('\u8ba4\u8bc1\u901a\u8fc7\uff0c\u7f51\u7edc\u6b63\u5e38')\n                        info()\n                        i = 0\n                    #time_update()\n\n                else:#\u7f51\u7edc\u5f02\u5e38\u6216\u672a\u8fde\u63a5\n                    with sync_playwright() as playwright:\n                        run(playwright)\n\n                time.sleep(int(temp&#91;6]))\n                n = 1\n            else:\n                if n == 1:\n                    printer('time2rest')\n                    n = 0\n                time.sleep(int(temp&#91;6]))\n                exit(0)<\/code><\/pre>\n","protected":false},"excerpt":{"rendered":"<p>\u65ad\u7ebf\u91cd\u8fde<\/p>\n","protected":false},"author":1,"featured_media":0,"comment_status":"closed","ping_status":"","sticky":false,"template":"","format":"standard","meta":{"footnotes":""},"categories":[1],"tags":[],"_links":{"self":[{"href":"http:\/\/192.168.5.111\/index.php\/wp-json\/wp\/v2\/posts\/744"}],"collection":[{"href":"http:\/\/192.168.5.111\/index.php\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"http:\/\/192.168.5.111\/index.php\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"http:\/\/192.168.5.111\/index.php\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"http:\/\/192.168.5.111\/index.php\/wp-json\/wp\/v2\/comments?post=744"}],"version-history":[{"count":3,"href":"http:\/\/192.168.5.111\/index.php\/wp-json\/wp\/v2\/posts\/744\/revisions"}],"predecessor-version":[{"id":807,"href":"http:\/\/192.168.5.111\/index.php\/wp-json\/wp\/v2\/posts\/744\/revisions\/807"}],"wp:attachment":[{"href":"http:\/\/192.168.5.111\/index.php\/wp-json\/wp\/v2\/media?parent=744"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"http:\/\/192.168.5.111\/index.php\/wp-json\/wp\/v2\/categories?post=744"},{"taxonomy":"post_tag","embeddable":true,"href":"http:\/\/192.168.5.111\/index.php\/wp-json\/wp\/v2\/tags?post=744"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}