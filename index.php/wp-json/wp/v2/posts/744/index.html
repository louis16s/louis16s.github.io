{"id":744,"date":"2023-06-02T18:50:41","date_gmt":"2023-06-02T10:50:41","guid":{"rendered":"http:\/\/192.168.5.111\/?p=744"},"modified":"2023-06-02T18:50:55","modified_gmt":"2023-06-02T10:50:55","slug":"%e6%a0%a1%e5%9b%ad%e7%bd%91%e8%87%aa%e5%8a%a8%e7%99%bb%e5%bd%95","status":"publish","type":"post","link":"http:\/\/192.168.5.111\/index.php\/2023\/06\/02\/%e6%a0%a1%e5%9b%ad%e7%bd%91%e8%87%aa%e5%8a%a8%e7%99%bb%e5%bd%95\/","title":{"rendered":"\u6821\u56ed\u7f51\u81ea\u52a8\u767b\u5f55"},"content":{"rendered":"\n<p>\u65ad\u7ebf\u91cd\u8fde<\/p>\n\n\n\n<figure class=\"wp-block-image size-full\"><img decoding=\"async\" width=\"503\" height=\"533\" src=\"http:\/\/192.168.5.111\/wp-content\/uploads\/2023\/06\/\u5c4f\u5e55\u622a\u56fe-2023-03-15-160451.jpg\" alt=\"\" class=\"wp-image-746\" srcset=\"http:\/\/192.168.5.111\/wp-content\/uploads\/2023\/06\/\u5c4f\u5e55\u622a\u56fe-2023-03-15-160451.jpg 503w, http:\/\/192.168.5.111\/wp-content\/uploads\/2023\/06\/\u5c4f\u5e55\u622a\u56fe-2023-03-15-160451-283x300.jpg 283w\" sizes=\"(max-width: 503px) 100vw, 503px\" \/><\/figure>\n\n\n\n<pre class=\"wp-block-code\"><code>#!\/user\/bin\/env pyhton\u89e3\u91ca\u5668\u8def\u5f84\r\n# -*-coding:utf-8-*- \u811a\u672c\u7f16\u7801\r\nimport cryptocode\r\nimport msvcrt\r\nimport os\r\nimport requests\r\nimport time\r\nimport pywifi\r\nfrom pywifi import const\r\nfrom configparser import ConfigParser\r\nfrom datetime import datetime\r\nfrom playwright.sync_api import Playwright, sync_playwright\r\nfrom rich.align import Align\r\nfrom rich.console import Console\r\nfrom rich.panel import Panel\r\nfrom rich.progress import track\r\nfrom rich.live import Live\r\nfrom rich.text import Text\r\n\r\nfile100 = 'config.ini'\r\nversion_info = '1.5'\r\n\r\n# \u8303\u56f4\u65f6\u95f4\r\nd_time = datetime.strptime(str(datetime.now().date())+'6:30', '%Y-%m-%d%H:%M')\r\nd_time1 =  datetime.strptime(str(datetime.now().date())+'23:30', '%Y-%m-%d%H:%M')\r\n\r\ndef run(playwright: Playwright) -> None:\r\n    try:\r\n        global context\r\n        browser = playwright.chromium.launch(headless=mode, channel=local)\r\n        context = browser.new_context()\r\n        page = context.new_page()\r\n        printer('url: ' + testurl)\r\n        page.goto(testurl)\r\n        printer('account: ' + account)\r\n        page.locator(\"&#91;placeholder=\\\"\u8bf7\u8f93\u5165\u8d26\u53f7\\\"]\").fill(account)  # .type(account)\r\n        printer('password: ' + len(password) * '*')\r\n        page.locator(\"&#91;placeholder=\\\"\u8bf7\u8f93\u5165\u5bc6\u7801\\\"]\").fill(password)\r\n        page.locator(\"xpath=\/\/*&#91;@id='protocol']\").click()\r\n        printer('submit')\r\n        page.locator(\"text=\u767b\u5f55\").click()\r\n        browser.close()\r\n        if network_check():\r\n            printer('success')\r\n        else:\r\n            printer('fail')\r\n\r\n    except:\r\n        printer('fail')\r\n\r\n    # \u4e0b\u7ebf\u529f\u80fd\r\n    ''' printer('enter to log out')\r\n        if len(input()) != 0:\r\n            page.click('xpath=\/\/*&#91;@id=\"logout\"]')\r\n            page.click('text=\u786e\u8ba4')\r\n            printer('exiting program...')\r\n            time.sleep(5)\r\n            #browser.close()\r\n            #sys.exit()'''\r\n\r\ndef file1():  # \u6587\u4ef6\u8bfb\u5199\r\n    global account, password, testurl, mode, local, connect, check\r\n    console = Console()\r\n    if os.path.exists(file100):  # \u6587\u4ef6\u5b58\u5728\u68c0\u6d4b\r\n        # printer('file existed')\r\n        cf = ConfigParser()\r\n        cf.read(file100)\r\n        version = cf.get('parm', 'ver')\r\n        if version &lt; version_info:\r\n            os.remove(file100)\r\n            with console.screen(style=\"bold white on red\") as screen:\r\n                text = Align.center(\"&#91;blink]\u914d\u7f6e\u6587\u4ef6\\n\u7248\u672c\u8fc7\u4f4e\\n\u81ea\u52a8\u5220\u9664&#91;\/blink]\", vertical=\"middle\")\r\n                screen.update(Panel(text))\r\n                time.sleep(5)\r\n            file1()\r\n        # main\r\n        account = cf.get('main', 'uid')\r\n        password = cf.get('main', 'pwd')\r\n        # parm\r\n        local = cf.get('parm', 'local')\r\n        mode = cf.get('parm', 'mode')\r\n        check = cf.get('parm', 'check')\r\n        connect = cf.get('parm', 'connect')\r\n        testurl = cf.get('parm', 'url')\r\n\r\n        # return account, password, testurl, mode, local, connect, check\r\n    else:\r\n        printer('config file not fund')\r\n        os.system('mode con cols=48 lines=23')\r\n        printer('\u5bc6\u7801\u4f1a\u81ea\u52a8\u52a0\u5bc6')\r\n        printer('\u8f93\u5165\u540e\u8bf7\u6309\u56de\u8f66')\r\n        printer('input account')\r\n        account = input()\r\n\r\n        printer('input password')\r\n        password = pwd_input()\r\n        print(' ')\r\n\r\n        printer('\u8fd0\u884c\u6a21\u5f0f\u9009\u62e9')\r\n        printer('headless(1)|browser(2)')\r\n        mode = input()\r\n\r\n        printer('\u6d4f\u89c8\u5668\u9009\u62e9')\r\n        printer('edge(1)|chrome(2)')\r\n        local = input()\r\n\r\n        printer('\u4f7f\u7528\u7f51\u7ebf(0)|GDOU.NET(1)')\r\n        connect = input()\r\n\r\n        printer('\u7f51\u7edc\u68c0\u67e5\u95f4\u9694\uff08\u79d2\uff09')\r\n        check = int(input())\r\n\r\n        testurl = 'http:\/\/1.1.1.1\/'\r\n        t0 = '\\n'\r\n        password = cryptocode.encrypt(password, 'louis16s')  # \u52a0\u5bc6\r\n\r\n        with open(file100, \"w\") as file:\r\n            file.write(\r\n                '&#91;main]' + t0 +\r\n                'uid = ' + str(account) + t0 +\r\n                'pwd = ' + str(password) + t0 +\r\n                '&#91;parm]' + t0 +\r\n                'local = ' + str(local) + t0 +\r\n                'mode = ' + str(mode) + t0 +\r\n                'check = ' + str(check) + t0 +\r\n                'connect = ' + str(connect) + t0 +\r\n                'url = ' + str(testurl) + t0 +\r\n                'ver = ' + version_info + t0)\r\n            file.close()\r\n        for step in track(range(100), description=\"Writing...\"):\r\n            time.sleep(0.01)\r\n        printer('config is generated')\r\n\r\n    password = cryptocode.decrypt(password, 'louis16s')  # \u89e3\u5bc6\r\n    # \u6d4f\u89c8\u5668\r\n    if local == '0':\r\n        local = None  # Chromium\r\n    if local == '1':\r\n        local = 'msedge'\r\n    if local == '2':\r\n        local = 'chrome'\r\n\r\n    if mode == '1':\r\n        mode = True  # \u65e0\u5934\u6a21\u5f0f\r\n    else:\r\n        mode = False\r\n\r\n    return account, password, testurl, mode, local, connect, check\r\n\r\ndef connect_wifi(ssid):\r\n    if ssid == '1':\r\n        ssid0 = \"GDOU.NET\"\r\n    if ssid == '2':\r\n        ssid0 = \"\u6d77\u5927\u6821\u56ed\u7f51\"\r\n    wifi = pywifi.PyWiFi()\r\n    ifaces = wifi.interfaces()&#91;0]\r\n    print(ifaces.name())  # \u8f93\u51fa\u65e0\u7ebf\u7f51\u5361\u540d\u79f0\r\n    ifaces.disconnect()\r\n    time.sleep(3)\r\n    profile = pywifi.Profile()  # \u914d\u7f6e\u6587\u4ef6\r\n    profile.ssid = ssid0  # wifi\u540d\u79f0\r\n    ifaces.remove_all_network_profiles()  # \u5220\u9664\u5176\u5b83\u914d\u7f6e\u6587\u4ef6\r\n    tmp_profile = ifaces.add_network_profile(profile)  # \u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6\r\n    ifaces.connect(tmp_profile)\r\n    time.sleep(3)\r\n    isok = True\r\n\r\n    if ifaces.status() == const.IFACE_CONNECTED:\r\n        print(\"connect successfully!\")\r\n    else:\r\n        print(\"connect failed!\")\r\n        print('turn on ur wifi')\r\n        time.sleep(5)\r\n        connect_wifi(ssid)\r\n\r\n    time.sleep(1)\r\n    return isok\r\n\r\ndef network_check():\r\n    try:\r\n        session = requests.Session()\r\n        html = session.get(\"https:\/\/www.baidu.com\", timeout=2)\r\n    except:\r\n        return False\r\n    return True\r\n\r\ndef os_checker():\r\n    temp = file1()\r\n    if temp&#91;5] != \"0\":\r\n        connect_wifi(temp&#91;5])\r\n    #os_version = platform.platform()\r\n    if os.path.exists(file100):\r\n        os.system('mode con cols=45 lines=8')\r\n        printer('version ' + version_info)\r\n        printer('script started')\r\n\r\ndef pwd_input():  # \u5bc6\u7801\r\n    chars = &#91;]\r\n    while True:\r\n        try:\r\n            newChar = msvcrt.getch().decode(encoding=\"utf-8\")\r\n        except:\r\n            return input(\"\u4f60\u5f88\u53ef\u80fd\u4e0d\u662f\u5728cmd\u547d\u4ee4\u884c\u4e0b\u8fd0\u884c\uff0c\u5bc6\u7801\u8f93\u5165\u5c06\u4e0d\u80fd\u9690\u85cf:\")\r\n        if newChar in '\\r\\n':  # \u5982\u679c\u662f\u6362\u884c\uff0c\u5219\u8f93\u5165\u7ed3\u675f\r\n            break\r\n        elif newChar == '\\b':  # \u5982\u679c\u662f\u9000\u683c\uff0c\u5219\u5220\u9664\u5bc6\u7801\u672b\u5c3e\u4e00\u4f4d\u5e76\u4e14\u5220\u9664\u4e00\u4e2a\u661f\u53f7\r\n            if chars:\r\n                del chars&#91;-1]\r\n                msvcrt.putch('\\b'.encode(encoding='utf-8'))  # \u5149\u6807\u56de\u9000\u4e00\u683c\r\n                msvcrt.putch(' '.encode(encoding='utf-8'))  # \u8f93\u51fa\u4e00\u4e2a\u7a7a\u683c\u8986\u76d6\u539f\u6765\u7684\u661f\u53f7\r\n                msvcrt.putch('\\b'.encode(encoding='utf-8'))  # \u5149\u6807\u56de\u9000\u4e00\u683c\u51c6\u5907\u63a5\u53d7\u65b0\u7684\u8f93\u5165\r\n        else:\r\n            chars.append(newChar)\r\n            msvcrt.putch('*'.encode(encoding='utf-8'))  # \u663e\u793a\u4e3a\u661f\u53f7\r\n    return (''.join(chars))\r\n\r\ndef printer(content):  # \u5f69\u8272\u8f93\u51fa\r\n    console = Console()\r\n    time1 = datetime.now().strftime('&#91;%Y-%m-%d]&#91;%H:%M:%S]')\r\n    console.print(time1, end='')\r\n    console.print(content, style=\"yellow\")\r\n\r\ndef info():\r\n    try:\r\n        url = (\"http:\/\/10.129.1.1\/cgi-bin\/rad_user_info?\"\r\n               \"callback=jQuery112406118340540763985_1556004912581&amp;_=1556004912582\")  # \u6307\u5b9a\u7f51\u5740\r\n        response = requests.get(url=url)  # \u53d1\u8d77\u8bf7\u6c42#get\u4f1a\u8fd4\u56de\u4e00\u4e2a\u54cd\u5e94\u5bf9\u8c61\r\n        detail = response.text.split(',')\r\n\r\n        ip = str(detail&#91;12].split(':')&#91;1]).replace('\"', \" \")\r\n        printer(\"ip:\" + ip)\r\n        sum = str(int(int(detail&#91;20].split(':')&#91;1])*0.000000001))\r\n        printer(\"\u5df2\u7528\u6d41\u91cf\uff1a\"+sum+\"GB\")\r\n        device = str(detail&#91;11].split(':')&#91;1]).replace('\"',\" \")\r\n        printer(\"\u5728\u7ebf\u8bbe\u5907:\" + device)\r\n    except:\r\n        printer(\"\u83b7\u53d6\u4fe1\u606f\u5931\u8d25\")\r\n\r\ndef time_update():\r\n    time1 = str(datetime.now().strftime('&#91;%Y-%m-%d]&#91;%H:%M:%S]'))\r\n    text = Text(time1+\"\u811a\u672c\u6b63\u5e38\u8fd0\u884c\u4e2d(\u65e0\u63d0\u793a)\")  # create renderable text object\r\n    live.update(text)  # update display with text object\r\n\r\nif __name__ == '__main__':\r\n    temp = file1()\r\n    os_checker()\r\n    i = 1\r\n    n = 1\r\n    with Live(refresh_per_second=1) as live:  # refresh once per second\r\n        while True:\r\n            # \u5f53\u524d\u65f6\u95f4\r\n            n_time = datetime.now()\r\n            if n_time > d_time and n_time &lt; d_time1:\r\n                if network_check():#\u7f51\u7edc\u6b63\u5e38\r\n                    if i == 1:\r\n                        printer('\u8ba4\u8bc1\u901a\u8fc7\uff0c\u7f51\u7edc\u6b63\u5e38')\r\n                        info()\r\n                        i = 0\r\n                    #time_update()\r\n\r\n                else:#\u7f51\u7edc\u5f02\u5e38\u6216\u672a\u8fde\u63a5\r\n                    with sync_playwright() as playwright:\r\n                        run(playwright)\r\n\r\n                time.sleep(int(temp&#91;6]))\r\n                n = 1\r\n            else:\r\n                if n == 1:\r\n                    printer('time2rest')\r\n                    n = 0\r\n                time.sleep(int(temp&#91;6]))\r\n                exit(0)<\/code><\/pre>\n","protected":false},"excerpt":{"rendered":"<p>\u65ad\u7ebf\u91cd\u8fde<\/p>\n","protected":false},"author":1,"featured_media":0,"comment_status":"closed","ping_status":"","sticky":false,"template":"","format":"standard","meta":[],"categories":[1],"tags":[],"_links":{"self":[{"href":"http:\/\/192.168.5.111\/index.php\/wp-json\/wp\/v2\/posts\/744"}],"collection":[{"href":"http:\/\/192.168.5.111\/index.php\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"http:\/\/192.168.5.111\/index.php\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"http:\/\/192.168.5.111\/index.php\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"http:\/\/192.168.5.111\/index.php\/wp-json\/wp\/v2\/comments?post=744"}],"version-history":[{"count":2,"href":"http:\/\/192.168.5.111\/index.php\/wp-json\/wp\/v2\/posts\/744\/revisions"}],"predecessor-version":[{"id":747,"href":"http:\/\/192.168.5.111\/index.php\/wp-json\/wp\/v2\/posts\/744\/revisions\/747"}],"wp:attachment":[{"href":"http:\/\/192.168.5.111\/index.php\/wp-json\/wp\/v2\/media?parent=744"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"http:\/\/192.168.5.111\/index.php\/wp-json\/wp\/v2\/categories?post=744"},{"taxonomy":"post_tag","embeddable":true,"href":"http:\/\/192.168.5.111\/index.php\/wp-json\/wp\/v2\/tags?post=744"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}