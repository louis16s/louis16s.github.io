{"id":748,"date":"2023-06-02T18:51:43","date_gmt":"2023-06-02T10:51:43","guid":{"rendered":"http:\/\/192.168.5.111\/?p=748"},"modified":"2023-06-02T18:51:43","modified_gmt":"2023-06-02T10:51:43","slug":"gdou%e7%94%b5%e8%b4%b9","status":"publish","type":"post","link":"http:\/\/192.168.5.111\/index.php\/2023\/06\/02\/gdou%e7%94%b5%e8%b4%b9\/","title":{"rendered":"gdou\u7535\u8d39"},"content":{"rendered":"\n<p>\u67e5\u8be2+\u5145\u503c<\/p>\n\n\n\n<figure class=\"wp-block-image size-full\"><img decoding=\"async\" width=\"415\" height=\"185\" src=\"http:\/\/192.168.5.111\/wp-content\/uploads\/2023\/06\/1.png\" alt=\"\" class=\"wp-image-749\" srcset=\"http:\/\/192.168.5.111\/wp-content\/uploads\/2023\/06\/1.png 415w, http:\/\/192.168.5.111\/wp-content\/uploads\/2023\/06\/1-300x134.png 300w\" sizes=\"(max-width: 415px) 100vw, 415px\" \/><\/figure>\n\n\n\n<pre class=\"wp-block-code\"><code>import time, os, re\r\nimport cryptocode\r\nimport msvcrt\r\nfrom configparser import ConfigParser\r\nfrom datetime import datetime\r\n\r\nfrom rich.align import Align\r\nfrom rich.console import Console\r\nfrom rich.panel import Panel\r\nfrom rich.progress import track\r\n\r\nfrom playwright.sync_api import Playwright, sync_playwright\r\n\r\nfile100 = 'bill.ini'\r\nversion_info = '1.0'\r\n\r\n\r\ndef pwd_input():  # \u5bc6\u7801\r\n    import msvcrt\r\n    chars = &#91;]\r\n    while True:\r\n        try:\r\n            newChar = msvcrt.getch().decode(encoding=\"utf-8\")\r\n        except:\r\n            return input(\"\u4f60\u5f88\u53ef\u80fd\u4e0d\u662f\u5728cmd\u547d\u4ee4\u884c\u4e0b\u8fd0\u884c\uff0c\u5bc6\u7801\u8f93\u5165\u5c06\u4e0d\u80fd\u9690\u85cf:\")\r\n        if newChar in '\\r\\n':  # \u5982\u679c\u662f\u6362\u884c\uff0c\u5219\u8f93\u5165\u7ed3\u675f\r\n            break\r\n        elif newChar == '\\b':  # \u5982\u679c\u662f\u9000\u683c\uff0c\u5219\u5220\u9664\u5bc6\u7801\u672b\u5c3e\u4e00\u4f4d\u5e76\u4e14\u5220\u9664\u4e00\u4e2a\u661f\u53f7\r\n            if chars:\r\n                del chars&#91;-1]\r\n                msvcrt.putch('\\b'.encode(encoding='utf-8'))  # \u5149\u6807\u56de\u9000\u4e00\u683c\r\n                msvcrt.putch(' '.encode(encoding='utf-8'))  # \u8f93\u51fa\u4e00\u4e2a\u7a7a\u683c\u8986\u76d6\u539f\u6765\u7684\u661f\u53f7\r\n                msvcrt.putch('\\b'.encode(encoding='utf-8'))  # \u5149\u6807\u56de\u9000\u4e00\u683c\u51c6\u5907\u63a5\u53d7\u65b0\u7684\u8f93\u5165\r\n        else:\r\n            chars.append(newChar)\r\n            msvcrt.putch('*'.encode(encoding='utf-8'))  # \u663e\u793a\u4e3a\u661f\u53f7\r\n    return (''.join(chars))\r\n\r\n\r\ndef printer(content, t=True, style=\"yellow\"):  # \u5f69\u8272\u8f93\u51fa\r\n    console = Console()\r\n    if t == True:\r\n        time1 = datetime.now().strftime('&#91;%Y-%m-%d]&#91;%H:%M:%S]')\r\n        console.print(time1, end='')\r\n    console.print(content, style=style)\r\n\r\n\r\ndef input_types(prompt, types, lens=0):\r\n    text = 0\r\n    while True:\r\n        try:\r\n            text = input()\r\n        except ValueError:\r\n            printer(prompt, style=\"green\")\r\n            continue\r\n        if lens == 0:\r\n            pattern = re.compile(r'\u6d77')\r\n            match = re.search(pattern, str(text))\r\n            if match and len(str(text)) == 2:\r\n                break\r\n            else:\r\n                printer(prompt, style=\"yellow\")\r\n        else:\r\n            if re.match(types, str(text)) and len(str(text)) == int(lens):\r\n                break\r\n            else:\r\n                printer(prompt, style=\"bold red\")\r\n    return text\r\n\r\n\r\ndef file1():  # \u6587\u4ef6\u8bfb\u5199\r\n    global name, account, password, domi0, domi1, domi2\r\n    console = Console()\r\n    if os.path.exists(file100):  # \u6587\u4ef6\u5b58\u5728\u68c0\u6d4b\r\n        # printer('file existed')\r\n        cf = ConfigParser()\r\n        cf.read(file100)\r\n        version = cf.get('parm', 'ver')\r\n        if version &lt; version_info:\r\n            os.remove(file100)\r\n            with console.screen(style=\"bold white on red\") as screen:\r\n                text = Align.center(\"&#91;blink]\u914d\u7f6e\u6587\u4ef6\\n\u7248\u672c\u8fc7\u4f4e\\n\u81ea\u52a8\u5220\u9664&#91;\/blink]\", vertical=\"middle\")\r\n                screen.update(Panel(text))\r\n                time.sleep(5)\r\n            file1()\r\n        # main\r\n        name = cf.get('main', 'nam')\r\n        account = cf.get('main', 'uid')\r\n        password = cf.get('main', 'pwd')\r\n        # parm\r\n        domi0 = cf.get('parm', 'domi0')\r\n        domi1 = cf.get('parm', 'domi1')\r\n        domi2 = cf.get('parm', 'domi2')\r\n\r\n        # return name, account, password, domi0, domi1, domi2\r\n    else:\r\n        printer('config file not fund')\r\n        os.system('mode con cols=44 lines=16')\r\n        printer('*' * 19 + ' GDOU ' + '*' * 19, style=\"bold red\", t=False)\r\n        printer('\u8bf7\u5982\u5b9e\u586b\u5199,\u5426\u5219\u65e0\u6cd5\u67e5\u8be2,\u8f93\u5165\u540e\u6309\u56de\u8f66', t=False)\r\n        printer('\u8f93\u5165\u4f60\u7684\u59d3\u540d')\r\n        name = input()\r\n        printer('\u8f93\u5165\u4f60\u7684\u5b66\u5de5\u53f7')\r\n        account = input_types('\u91cd\u65b0\u8f93\u5165\u4f60\u7684\u5b66\u5de5\u53f7', r'^&#91;0-9]*$', 12)\r\n\r\n        printer('\u8f93\u5165\u767b\u9646\u5bc6\u7801')\r\n        password = pwd_input()\r\n        print(' ')\r\n\r\n        printer('\u8f93\u5165\u5927\u9662\u3010\u6d77*\u3011')\r\n        domi0 = input_types('\u91cd\u65b0\u8f93\u5165\u5927\u9662\u3010\u6d77*\u3011', r'^\u6d77', 0)\r\n        printer('\u8f93\u5165\u697c\u680b\u3010A|B|C\u3011')\r\n        domi1 = input_types('\u91cd\u65b0\u8f93\u5165\u697c\u680b\u3010A|B|C\u3011', r'^&#91;A-C]$', 1)\r\n        printer('\u8f93\u5165\u623f\u53f7\u3010502\u3011')\r\n        domi2 = input_types('\u91cd\u65b0\u8f93\u5165\u623f\u53f7\u3010502\u3011', r'^&#91;0-9]*$', 3)\r\n\r\n        t0 = '\\n'\r\n        password = cryptocode.encrypt(password, 'louis16s')  # \u52a0\u5bc6\r\n\r\n        with open(file100, \"w\") as file:\r\n            file.write(\r\n                '&#91;main]' + t0 +\r\n                'nam = ' + str(name) + t0 +\r\n                'uid = ' + str(account) + t0 +\r\n                'pwd = ' + str(password) + t0 +\r\n                '&#91;parm]' + t0 +\r\n                'domi0 = ' + str(domi0) + t0 +\r\n                'domi1 = ' + str(domi1) + t0 +\r\n                'domi2 = ' + str(domi2) + t0 +\r\n                'ver = ' + version_info + t0)\r\n            file.close()\r\n        for step in track(range(100), description=\"Writing...\"):\r\n            time.sleep(0.01)\r\n        printer('config is generated')\r\n\r\n    password = cryptocode.decrypt(password, 'louis16s')  # \u89e3\u5bc6\r\n\r\n    return name, account, password, domi0, domi1, domi2\r\n\r\n\r\ndef run(playwright: Playwright) -> None:\r\n    browser = playwright.chromium.launch(channel=\"msedge\", headless=True)\r\n    context = browser.new_context()\r\n    page = context.new_page()\r\n    page.goto(\"http:\/\/cz.gdou.edu.cn\/#\/gdhydxlogin\")\r\n    # page.route(\"**\/*.jpg\", lambda route: route.abort())\r\n    name, account, password, domi0, domi1, domi2 = file1()\r\n    temp1 = domi0 + domi1\r\n    temp2 = int(domi2)\r\n    temp2 \/\/= 100\r\n    temp2 = str(temp2) + '\u697c'\r\n    page.get_by_role(\"textbox\").first.fill(name)\r\n    page.get_by_role(\"textbox\").nth(1).fill(account)\r\n    page.get_by_role(\"textbox\").nth(2).fill(str(password))\r\n    page.get_by_text(\"\u786e\u5b9a\").click()\r\n    # page.get_by_placeholder(\"\u8bf7\u9009\u62e9\").first.click()\r\n    # page.get_by_role(\"listitem\").filter(has_text=\"\u6e56\u5149\u6821\u533a\").click()\r\n    page.get_by_placeholder(\"\u8bf7\u9009\u62e9\").nth(1).click()\r\n    page.get_by_role(\"listitem\").filter(has_text=temp1).click()\r\n    page.get_by_placeholder(\"\u8bf7\u9009\u62e9\").nth(2).click()\r\n    page.get_by_role(\"listitem\").filter(has_text=temp2).click()\r\n    page.get_by_placeholder(\"\u8bf7\u9009\u62e9\").nth(3).click()\r\n    page.get_by_role(\"listitem\").filter(has_text=domi2).click()\r\n    page.get_by_text(\"\u786e\u5b9a\").click()\r\n    page.locator(\"div\").filter(has_text=\"\u7535\u8868\").nth(3).click()\r\n    target_element0 = page.query_selector('#app > div > div.content > div.top_detail > div.number > div.left')\r\n    if target_element0:\r\n        printer(target_element0.inner_text().split('\\n')&#91;0] + ' ' + target_element0.inner_text().split('\\n')&#91;1])\r\n    else:\r\n        printer('\u67e5\u8be2\u7f51\u5740\u597d\u50cf\u51fa\u73b0\u4e86\u4e00\u4e9b\u95ee\u9898', style=\"bold red\", t=False)\r\n\r\n    printer('\u603b\u7528\u7535\u91cf(kWh) ' + str(\r\n        page.text_content(selector=\"#app > div > div.content > div.bottom_detail > div:nth-child(1) > div.number\")))\r\n    # page.screenshot(path=\"screenshot.png\", full_page=True)\r\n    page.get_by_text(\"\u6708\u7528\u7535\u8d26\u5355\").click()\r\n    target_element1 = page.query_selector('#app > div > div.content > div.list > div:nth-child(4) > div.number > span')\r\n    if target_element1:\r\n        printer('\u5f53\u6708\u7535\u8d39(\u5143\uff09' + ' ' + str(target_element1.inner_text()))\r\n    else:\r\n        printer('\u67e5\u8be2\u7f51\u5740\u597d\u50cf\u51fa\u73b0\u4e86\u4e00\u4e9b\u95ee\u9898', style=\"bold red\", t=False)\r\n    page.locator(\"img\").click()\r\n    # \u5145\u503c\u529f\u80fd\r\n    #time.sleep(1000)\r\n    printer('\u662f\u5426\u5145\u503c?(\u56de\u8f66\u786e\u8ba4)', t=False)\r\n    if input() == '':\r\n        page.get_by_placeholder(\"\u8bf7\u8f93\u5165\u5145\u503c\u91d1\u989d\").fill(input('\u8bf7\u8f93\u5165\u5145\u503c\u91d1\u989d:'))\r\n        page.get_by_placeholder(\"\u8bf7\u8f93\u5165\u652f\u4ed8\u5bc6\u7801\").fill(input('\u8bf7\u8f93\u5165\u652f\u4ed8\u5bc6\u7801:'))\r\n        page.get_by_text(\"\u786e\u5b9a\u5145\u503c\").click()\r\n        page.get_by_role(\"button\", name=\"\u786e\u5b9a\").click()\r\n        time.sleep(10)\r\n    else:\r\n        pass\r\n    # ---------------------\r\n    context.close()\r\n    browser.close()\r\n\r\n\r\nwith sync_playwright() as playwright:\r\n    printer('script started')\r\n    temp = file1()\r\n    if os.path.exists(file100):\r\n        os.system('mode con cols=45 lines=9')\r\n        printer('\u7535\u8d39\u7ba1\u7406 version ' + version_info)\r\n        printer('\u67e5\u8be2\u8d26\u53f7:' + temp&#91;1])\r\n        printer('\u67e5\u8be2\u623f\u95f4:' + temp&#91;3] + temp&#91;4] + temp&#91;5])\r\n\r\n        try:\r\n            run(playwright)\r\n        except:\r\n            printer('script error')\r\n            exit(1)\r\n<\/code><\/pre>\n","protected":false},"excerpt":{"rendered":"<p>\u67e5\u8be2+\u5145\u503c<\/p>\n","protected":false},"author":1,"featured_media":0,"comment_status":"closed","ping_status":"","sticky":false,"template":"","format":"standard","meta":[],"categories":[1],"tags":[],"_links":{"self":[{"href":"http:\/\/192.168.5.111\/index.php\/wp-json\/wp\/v2\/posts\/748"}],"collection":[{"href":"http:\/\/192.168.5.111\/index.php\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"http:\/\/192.168.5.111\/index.php\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"http:\/\/192.168.5.111\/index.php\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"http:\/\/192.168.5.111\/index.php\/wp-json\/wp\/v2\/comments?post=748"}],"version-history":[{"count":1,"href":"http:\/\/192.168.5.111\/index.php\/wp-json\/wp\/v2\/posts\/748\/revisions"}],"predecessor-version":[{"id":750,"href":"http:\/\/192.168.5.111\/index.php\/wp-json\/wp\/v2\/posts\/748\/revisions\/750"}],"wp:attachment":[{"href":"http:\/\/192.168.5.111\/index.php\/wp-json\/wp\/v2\/media?parent=748"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"http:\/\/192.168.5.111\/index.php\/wp-json\/wp\/v2\/categories?post=748"},{"taxonomy":"post_tag","embeddable":true,"href":"http:\/\/192.168.5.111\/index.php\/wp-json\/wp\/v2\/tags?post=748"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}